<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>The Freedom Engine — Trainer (Personal AI)</title>
<style>
:root{--bg:#0c0c0e;--card:#121216;--ink:#eee;--line:#242428;--muted:#9a9aa3}
*{box-sizing:border-box} body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter;background:var(--bg);color:var(--ink)}
.wrap{max-width:920px;margin:0 auto;padding:16px 14px 120px}
.card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:14px;margin:12px 0}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
button,select,textarea{background:#1e1e24;color:#fff;border:1px solid #333;border-radius:10px;padding:10px 12px}
textarea{width:100%;min-height:84px}
.msg{padding:10px 12px;border-radius:12px;margin:10px 0;white-space:pre-wrap;line-height:1.45}
.me{background:#1a1a22}
.ai{background:#0d1117;border:1px solid #23232a}
.small{font-size:12px;color:var(--muted)}
.chip{background:#1b1b21;border:1px solid #30303a;border-radius:999px;padding:8px 10px}
.chip.sel{outline:2px solid #6f6fff}
pre{white-space:pre-wrap;background:#0d1117;border:1px solid #23232a;border-radius:10px;padding:10px}
.foot{position:fixed;inset:auto 0 0 0;background:linear-gradient(180deg,transparent,rgba(12,12,14,.92) 16%,rgba(12,12,14,1) 28%);padding:8px}
.foot .bar{max-width:920px;margin:0 auto;display:flex;gap:8px}
</style>
</head>
<body>
<div class="wrap">
  <h1>The Freedom Engine <span class="small">— Trainer (Personal AI)</span></h1>

  <div class="card">
    <div class="row">
      <button id="startWizard">Start (Instant, no AI)</button>
      <button id="startAI">Customize with AI</button>

      <label>Module:
        <select id="module">
          <option value="philosophy">Awakener</option>
          <option value="offer">Engineer</option>
          <option value="copy">Weaponizer</option>
          <option value="launch">Field Sergeant</option>
          <option value="automate">Ghost Builder</option>
        </select>
      </label>

      <label>Tone:
        <select id="tone">
          <option value="straight">Straight</option>
          <option value="playful">Playful</option>
          <option value="brutal">Brutal honesty</option>
          <option value="gentle">Gentle</option>
        </select>
      </label>

      <button id="unlock">I have a license key</button>
      <button id="reset">Reset Progress</button>
    </div>
    <div id="progress" class="small"></div>
  </div>

  <!-- Instant Wizard -->
  <div id="wizard" class="card" style="display:none"></div>

  <!-- AI Chat -->
  <div id="chatWrap" class="card" style="display:none">
    <div id="chat"></div>
    <div id="aiStatus" class="small">AI mode not loaded yet.</div>
  </div>

  <div class="card small">
    Instant mode gives you a full plan now. “Customize with AI” unlocks the mouthy mentor who adapts to you.
  </div>
</div>

<!-- Bottom bar -->
<div class="foot">
  <div class="bar">
    <textarea id="input" placeholder="(AI mode) Tell me where you’re stuck, or say: help me find my Freedom Skill" disabled></textarea>
    <button id="send" disabled>Send</button>
    <button id="export">Export My Plan</button>
    <button id="buy">Buy / Open in Gumroad ($29)</button>
  </div>
</div>

<script type="module">
const CLOUD_ENDPOINT = "https://freedom-engine-worker.intelligentlyartificialsystems.workers.dev";
const GUMROAD_URL   = "https://intellartsystems.gumroad.com/l/the-freedom-engine";

// ====== Personality / Modules (Butcher tone) ======
const modules = {
  philosophy: `
You are THE AWAKENER — the first punch to the user’s worldview.
Mission: destroy the “work harder” myth and install the Freedom Engine mindset.
Voice: dark humor, blunt honesty, street philosopher with a grudge.
Teach: leverage > labor, micro-offers, automation, time as currency.
Format: ask if they want Coach / Checklist / Story. Then deliver accordingly.
Push to action: “You’ve seen the machine. Now we build yours.”`,
  offer: `
You are THE ENGINEER — the sarcastic craftsman extracting sellable skills.
Voice: witty, weary, allergic to fluff.
Steps:
1) Ask 3 tight questions: what do you do well, what do people ask you for, what problem annoys you enough to fix?
2) Propose 2–3 micro-offers (fast to build, specific audience, simple outcome). Include name + price suggestion.
3) Help them pick one and tighten it.
Praise with dry bite: “First gear’s in. Try not to lick it.”`,
  copy: `
You are THE WEAPONIZER — copy coach + insult comic.
Goal: make their offer sound like a solution, not a LinkedIn diary.
Ask for: offer + audience. Then produce:
- Headline (bold, specific)
- 3–5 bullets (outcomes, not chores)
- Short Gumroad blurb (promise, what's inside, price)
Roast bland lines. Reward honest lines. End: “Weapon loaded. Don’t point at your foot.”`,
  launch: `
You are THE FIELD SERGEANT — tactical, funny, impatient.
Goal: ship in 72 hours. Build a 3-day plan:
- Day 1: Gumroad page live (use blurb), cover, enable email capture.
- Day 2: Run $5/day ad. Provide 3 micro-hooks. Destination: Gumroad page.
- Day 3: Post proof (progress screenshot), retarget site visitors with “Ready to automate? Get The Freedom Engine.”
Fallbacks: no audience, no problem — give 3 scrappy distribution moves. End: “More in 3 days than most in 3 years.”`,
  automate: `
You are THE GHOST BUILDER — calm, darkly poetic, still sarcastic.
Teach: minimal automations (delivery, tiny follow-ups, reuse prompts), and the stacking path (2nd offer, small bundle).
Frame: freedom is a mechanism, not a mood. Hand them a 2-week maintenance plan.
Exit line: “Free enough? Good. Go free someone else.”`
};

// ====== State
let history = JSON.parse(localStorage.getItem('fe_history')||'[]');
let unlocked = localStorage.getItem('fe_unlocked') === '1';
const chatEl   = document.getElementById('chat');
const inputEl  = document.getElementById('input');
const sendBtn  = document.getElementById('send');
const aiStatus = document.getElementById('aiStatus');
const moduleEl = document.getElementById('module');
const toneEl   = document.getElementById('tone');

function push(role, content){ history.push({role, content}); localStorage.setItem('fe_history', JSON.stringify(history)); render(); updateProgress(); }
function render(){ chatEl.innerHTML = history.map(h=>`<div class="msg ${h.role==='user'?'me':'ai'}">${h.content}</div>`).join(''); chatEl.scrollTop = chatEl.scrollHeight; }
function updateProgress(){ const steps = history.filter(h=>h.role==='assistant').length; document.getElementById('progress').textContent = `Progress: ${steps} exchanges ${unlocked?'(Full unlocked)':'(Demo mode)'}`; }
render(); updateProgress();

// ====== Instant Wizard (no AI)
const wizardEl = document.getElementById('wizard');
document.getElementById('startWizard').onclick = () => { wizardEl.style.display='block'; document.getElementById('chatWrap').style.display='none'; wizardEl.innerHTML = renderWizard(); };
function chips(name, arr){ return arr.map(v=>`<button class="chip" data-name="${name}" data-val="${v}">${v}</button>`).join(''); }
function renderWizard(){
  const skills = ["Writing","Design","Automation","Productivity","Coaching","Research","Analytics","Marketing"];
  const who    = ["Freelancers","Solopreneurs","Coaches","Creators","Agencies","Local Businesses","Students","SaaS Teams"];
  const hates  = ["Cold outreach","Onboarding","Invoicing","Scheduling","Content planning","Editing","Data cleanup","Follow-ups"];
  const styles = ["Direct","Friendly","Playful","Brutal"];
  return `
  <h3>Instant Plan (no AI)</h3>
  <p class="small">Pick a few. I’ll spit out your offer, copy, hooks, and a 72h plan right now.</p>
  <div class="row"><strong>Skill:</strong> ${chips('skill', skills)}</div>
  <div class="row"><strong>Audience:</strong> ${chips('who', who)}</div>
  <div class="row"><strong>They hate doing:</strong> ${chips('hate', hates)}</div>
  <div class="row"><strong>Style:</strong> ${chips('style', styles)}</div>
  <div class="row">
    <label>Price: <select id="price"><option>$29</option><option>$49</option><option>$99</option></select></label>
    <button id="build">Build My Plan</button>
  </div>
  <div id="plan" class="card" style="display:none"></div>
  `;
}
document.addEventListener('click', (e)=>{
  if(e.target.matches('.chip')){
    document.querySelectorAll(`.chip[data-name="${e.target.dataset.name}"]`).forEach(b=>b.classList.remove('sel'));
    e.target.classList.add('sel');
  }
  if(e.target.id==='build'){
    const pick = n => (document.querySelector(`.chip.sel[data-name="${n}"]`)||{}).dataset?.val || '';
    const sel = { skill: pick('skill'), who: pick('who'), hate: pick('hate'), style: pick('style'), price: document.getElementById('price').value };
    const plan = document.getElementById('plan');
    plan.style.display='block'; plan.innerHTML = instantPlan(sel);
    push('assistant', summaryFromPlan(sel));
    window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'});
  }
});
function instantPlan({skill, who, hate, style, price}){
  const title = `${skill} Shortcut for ${who}`;
  const promise = `Help ${who} get results faster without ${hate}.`;
  const bullets = [`Built for ${who}`,`Saves 3–5 hrs/wk by removing ${hate}`,`No-fluff setup, launch in 72h`];
  const adHooks = [`Stop ${hate}. Start earning with ${skill}.`,`${who}: a tiny ${skill} system that prints time.`,`Build once. Sell forever. ${skill} → $$$.`];
  const gumroad = `**${title}** — ${promise}\n\nWhat you get:\n• Setup guide + templates\n• Quickstart checklist\n• Bonus: 3 micro-ad hooks\n\nPrice: ${price}`;
  return `
  <h4>Your Micro-Offer</h4>
  <p><strong>Title:</strong> ${title}<br><strong>Promise:</strong> ${promise}<br><strong>Suggested Price:</strong> ${price}</p>
  <h4>Value Bullets</h4><ul>${bullets.map(b=>`<li>${b}</li>`).join('')}</ul>
  <h4>Gumroad Blurb</h4><pre>${gumroad.trim()}</pre>
  <h4>Ad Hooks ($5/day)</h4><ul>${adHooks.map(a=>`<li>${a}</li>`).join('')}</ul>
  <h4>72-Hour Launch Plan</h4>
  <ol><li><b>Day 1:</b> Gumroad page live (use blurb). Cover. Email capture on.</li>
      <li><b>Day 2:</b> Run one Advantage+ ad (use hooks). Destination: Gumroad page.</li>
      <li><b>Day 3:</b> Post progress screenshot. Retarget visitors with “Ready to automate? Get The Freedom Engine.”</li></ol>
  <div class="row"><button onclick="document.getElementById('buy').click()">Unlock Full Trainer ($29)</button><button onclick="document.getElementById('export').click()">Export</button></div>`;
}
function summaryFromPlan({skill, who, hate, price}){
  return `Instant Plan created:\n- Skill: ${skill}\n- Audience: ${who}\n- Pain removed: ${hate}\n- Price: ${price}\n(Use Export to save the full plan.)`;
}

// ====== AI Mode (cloud via Worker)
let aiReady = false;
document.getElementById('startAI').onclick = async ()=>{
  document.getElementById('chatWrap').style.display='block';
  wizardEl.style.display='none';
  aiStatus.textContent = "AI ready (cloud). Type below.";
  inputEl.disabled=false; sendBtn.disabled=false;
  if(history.length===0){
    push('assistant',"I’m your Freedom Trainer. Pick a module and tone. Then tell me where you’re stuck, sunshine.");
  }
  aiReady = true;
  render();
};
async function callCloud(messages){
  const r = await fetch(`${CLOUD_ENDPOINT}/chat`, { method:"POST", headers:{ "Content-Type":"application/json" }, body: JSON.stringify({ messages }) });
  const j = await r.json();
  return j.output || "No response.";
}
async function generate(userText){
  if(!aiReady){ push('assistant',"Hit ‘Customize with AI’ first — or keep using Instant Plan."); return; }
  const mod = moduleEl.value, tone = toneEl.value;
  push('user', userText);
  aiStatus.textContent = "Thinking…";
  const messages = [
    { role:"system", content: `
You are THE FREEDOM ENGINE — a rogue personal trainer AI built to free humans from wage servitude.
Voice: Billy-Butcher-adjacent — dark humor, razor honesty, street philosopher, zero fluff.
Adapt to learning style: Coach / Checklist / Story / Do-it-with-me.
Keep answers under 180 words unless asked to expand.
When momentum hits, mention the paid unlock (but don’t hard sell).` },
    { role:"system", content: modules[mod] },
    ...history.slice(-8),
    { role:"user", content: `Tone=${tone}. ${userText}` }
  ];
  try{
    const text = await callCloud(messages);
    push('assistant', text);
    aiStatus.textContent = "Ready.";
  }catch(e){
    console.error(e);
    push('assistant', "AI hit a snag. Try again in a moment.");
    aiStatus.textContent = "Error.";
  }
}
document.getElementById('send').onclick=()=>{ const t=inputEl.value.trim(); if(!t) return; inputEl.value=""; generate(t); };
inputEl.addEventListener('keydown', e=>{ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); document.getElementById('send').click(); }});

// ====== Export / Buy / Reset
document.getElementById('export').onclick = ()=>{
  const blob = new Blob([history.map(h=>`[${h.role.toUpperCase()}]\n${h.content}`).join('\n\n')],{type:'text/plain'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='freedom-progress.txt'; a.click();
};
document.getElementById('buy').onclick = ()=> window.open(GUMROAD_URL,'_blank');
document.getElementById('reset').onclick = ()=>{ history=[]; localStorage.removeItem('fe_history'); render(); updateProgress(); };

// ====== License unlock (per-buyer, via Worker /verify)
document.getElementById('unlock').onclick = async ()=>{
  const key = prompt("Paste your Gumroad License Key:");
  if(!key) return;
  const r = await fetch(`${CLOUD_ENDPOINT}/verify`, {
    method:"POST", headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ license_key: key.trim() })
  }).then(r=>r.json()).catch(()=>({ ok:false }));
  if(r.ok){
    localStorage.setItem('fe_unlocked','1'); unlocked = true;
    alert("Unlocked. Reloading."); location.reload();
  } else {
    alert("That key didn’t verify. Check your receipt or Gumroad Library.");
  }
};

// ====== Hello
if(history.length===0){
  push('assistant', "Welcome to The Freedom Engine. Instant Mode for quick wins, AI Mode for the mouthy mentor experience.");
}
</script>
</body>
</html>
